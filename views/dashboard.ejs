<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ST STUDIO Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
  background:#f4f6f9;
  font-family:'Segoe UI',sans-serif;
}
.navbar{
  background:#0d3b66;
}
.card{
  border-radius:15px;
}
.badge-status{
  font-size:13px;
}
.qr-img{
  width:80px;
}
</style>
</head>

<body>

<nav class="navbar navbar-dark">
  <div class="container-fluid">
    <span class="navbar-brand d-flex align-items-center">
      <img src="/logo.png" width="40" class="me-2">
      ST STUDIO Sharpen Shop Pro
    </span>
  </div>
</nav>

<div class="container py-4">

<!-- ฟอร์มเพิ่มงาน -->
<div class="card shadow p-3 mb-4">
  <h5 class="mb-3 text-primary">เพิ่มงานลับคมใหม่</h5>

  <form method="POST" action="/create">
    <div class="row g-2">

      <div class="col-12 col-md-4">
        <input name="customerName" class="form-control" placeholder="ชื่อลูกค้า" required>
      </div>

      <div class="col-12 col-md-4">
        <input name="phone" class="form-control" placeholder="เบอร์โทร">
      </div>

      <div class="col-12 col-md-4">
        <input name="itemType" class="form-control" placeholder="ประเภทของมีด">
      </div>

      <div class="col-12 col-md-2">
        <input name="quantity" type="number" class="form-control" placeholder="จำนวน">
      </div>

    </div>

    <button class="btn btn-primary mt-3 w-100">สร้างงาน</button>
  </form>
</div>

<!-- ตารางรายการงาน -->
<div class="card shadow p-3">
  <h5 class="mb-3 text-primary">รายการงานทั้งหมด</h5>

  <div class="table-responsive">
  <table class="table table-bordered align-middle">
    <thead class="table-dark">
      <tr>
        <th>ลูกค้า</th>
        <th>รายการ</th>
        <th>สถานะ</th>
        <th>QR</th>
        <th>อัปโหลดภาพ</th>
      </tr>
    </thead>

    <tbody>
      <% jobs.forEach(job => { %>
      <tr>
        <td>
          <strong><%= job.customerName %></strong><br>
          <small class="text-muted"><%= job.phone %></small>
        </td>

        <td>
          <%= job.itemType %><br>
          จำนวน: <%= job.quantity %>
        </td>

        <td>
          <form action="/update/<%= job.jobId %>" method="POST">
            <select name="status" class="form-select form-select-sm mb-1">
              <option <%= job.status==="รับงานแล้ว"?"selected":"" %>>รับงานแล้ว</option>
              <option <%= job.status==="กำลังลับคม"?"selected":"" %>>กำลังลับคม</option>
              <option <%= job.status==="เสร็จแล้ว"?"selected":"" %>>เสร็จแล้ว</option>
              <option <%= job.status==="รับของแล้ว"?"selected":"" %>>รับของแล้ว</option>
            </select>
            <button class="btn btn-success btn-sm w-100">อัปเดต</button>
          </form>
        </td>

        <td class="text-center">
          <img src="<%= job.qr %>" class="qr-img"><br>
          <a href="/track/<%= job.jobId %>" target="_blank">ดูหน้า</a>
        </td>

        <td>
          <% if(job.imageUrl){ %>
            <img src="<%= job.imageUrl %>" class="img-fluid mb-2 rounded">
          <% } %>

          <form action="/upload/<%= job.jobId %>" 
                method="POST" 
                enctype="multipart/form-data">
            <input type="file" 
                   name="image" 
                   class="form-control form-control-sm mb-1"
                   accept="image/*" required>
            <button class="btn btn-warning btn-sm w-100">
              อัปโหลด
            </button>
          </form>
        </td>

      </tr>
      <% }) %>
    </tbody>
  </table>
  </div>
</div>

</div>
</body>
</html>
